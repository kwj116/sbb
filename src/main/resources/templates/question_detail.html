<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="stylesheet" type="text/css" th:href="@{/css/style.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/question_detail.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/center_layout.css}">
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
    <div class="container">
        <div th:replace="~{header/header :: headerFragment}"></div>
        <div class="content_box">
            <h1 th:text="${question.subject}"></h1>
            <span th:if="${question.author != null}" th:text="|${question.author.username}|"></span>&ensp;|
                <span th:text="${#temporals.format(question.createDate, 'yyyy.MM.dd HH:mm')}"></span>&ensp;|
                <span th:text="|Ï°∞ÌöåÏàò ${question.view}|"></span>
            <br><br>
            <div th:utext="${@commonUtil.markdown(question.content)}"></div>
        </div>
        <!--Ï∂îÏ≤ú Î≤ÑÌäº-->
        <a class="recommend" href="javascript:void(0);" th:data-uri="@{|/question/vote/${question.id}|}">
            üëç
            <span th:text="${#lists.size(question.voter)}"></span>
        </a>
        <!--ÏßàÎ¨∏ ÏàòÏ†ï-->
        <a class="modify"  th:href="@{|/question/modify/${question.id}|}" sec:authorize="isAuthenticated()"
        th:if="${question.author != null and #authentication.getPrincipal().getUsername() == question.author.username}"
        th:text="ÏàòÏ†ï|">
        </a>

        <!--ÏßàÎ¨∏ ÏÇ≠Ï†ú-->
        <a class="delete" href="javascript:void(0)"
           th:data-uri="@{|/question/delete/${question.id}|}"
           sec:authorize="isAuthenticated()"
           th:if="${question.author != null and #authentication.getPrincipal().getUsername()==question.author.username}"
           th:text="ÏÇ≠Ï†ú">
        </a>

        <h5 th:text="|${#lists.size(question.answerList)}Í∞úÏùò ÎãµÎ≥ÄÏù¥ ÏûàÏäµÎãàÎã§.|"></h5>
        <hr>
        <br>
        <div th:each="answer : ${question.answerList}">
            <!--Î∞ëÏùò aÌÉúÍ∑∏Îäî ÎãµÎ≥Ä Îì±Î°ù,ÏàòÏ†ï,Ï∂îÏ≤úÎì±ÏùÑ ÌïòÎ©¥ ÏûëÏóÖÌïú ÎãµÎ≥ÄÎ∂ÄÎ∂ÑÏúºÎ°ú Í∞ÄÎèÑÎ°ù ÌïòÍ∏∞ ÏúÑÌï¥ ÏûëÏÑ±Îêú ÏΩîÎìú  -->
            <a th:id="|answer_${answer.id}|"></a>
            <div>
                <span th:if="${answer.author != null}" th:text="|${answer.author.username} (${#temporals.format(answer.createDate, 'yyyy.MM.dd.HH:mm')})|">
                </span>
                <span class="modified_text" th:if="${answer.modifyDate !=null}" >
                    (ÏàòÏ†ïÎê®)
                </span>
                <a class="recommend" href="javascript:void(0);" th:data-uri="@{|/answer/vote/${answer.id}|}">
                    üëç
                </a>
                <span th:text="${#lists.size(answer.voter)}"></span>
                <p th:utext="${@commonUtil.markdown(answer.content)}"></p>
                <p class="recommend_box">

                    <!--ÎãµÎ≥ÄÏàòÏ†ï-->
                    <a class="modify" th:href="@{|/answer/modify/${answer.id}|}" sec:authorize="isAuthenticated()"
                    th:text="ÏàòÏ†ï"
                    th:if="${answer.author != null and #authentication.getPrincipal().getUsername() == answer.author.username}">
                    </a>
                    <!--ÎãµÎ≥ÄÏÇ≠Ï†ú-->
                    <a class="delete" href="javascript:void(0);" th:data-uri="@{|/answer/delete/${answer.id}|}"
                    th:if="${answer.author !=null and #authentication.getPrincipal().getUsername() == answer.author.username}"
                    th:text="ÏÇ≠Ï†ú"
                    sec:authorize="isAuthenticated()"></a>
                    <!--ÎåìÍ∏Ä-->
                    <div th:each="comment : ${answer.comments}">
                            &ensp;„Ñ¥<span th:text="${comment.content}"></span>
                            <span th:if="${comment.modifyDate != null}"
                                  th:text="| - ${comment.author.username}, ${#temporals.format(comment.createDate, 'yyyy.MM.dd HH:mm')}
                            (ÏàòÏ†ï : ${#temporals.format(comment.modifyDate, 'yyyy.MM.dd HH:mm')}">
                            </span>
                            <span th:if="${comment.modifyDate == null}"
                                  th:text="| - ${comment.author.username}, ${#temporals.format(comment.createDate, 'yyyy.MM.dd HH:mm')}|">
                            </span>
                    </div>
                    <div class="comment_btn" th:id="${answer.id}" >
                        <form th:action="@{|/comment/create/${answer.id}|}" th:object="${commentForm}" method="post">

                            <textarea class="comment_area" sec:authorize="isAnonymous()" disabled placeholder="Î°úÍ∑∏Ïù∏Ïãú ÎåìÍ∏ÄÏûëÏÑ± Í∞ÄÎä• Ìï©ÎãàÎã§." th:field="*{content}"></textarea>
                            <textarea class="comment_area" sec:authorize="isAuthenticated()" placeholder="ÎåìÍ∏ÄÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî." th:field="*{content}"></textarea>
                            <div th:replace="~{form_errors :: formErrorsFragment}"></div>
                            <input type="hidden" name="questionId" th:value="${question.id}"><br>
                            <input class="comment" type="submit" value="ÎåìÍ∏Ä Îì±Î°ù">
                        </form>
                    </div>
                </p>
            </div>
            <br>
            <hr>
        </div>
        

        <form th:action="@{|/answer/create/${question.id}|}" th:object="${answerForm}" method="post">
            <div th:replace="~{form_errors :: formErrorsFragment}"></div>
            <!--isAnonymous() : Î°úÍ∑∏ÏïÑÏõÉ ÏÉÅÌÉúÏùº Í≤ΩÏö∞-->
            <!--isAuthenticated() : Î°úÍ∑∏Ïù∏ ÏÉÅÌÉúÏùº Í≤ΩÏö∞-->
            <textarea placeholder="Î°úÍ∑∏Ïù∏Ïãú ÎãµÍ∏ÄÏûëÏÑ± Í∞ÄÎä• Ìï©ÎãàÎã§."sec:authorize="isAnonymous()" disabled th:field="*{content}"></textarea>
            <textarea placeholder="ÎåìÍ∏ÄÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî." sec:authorize="isAuthenticated()" th:field="*{content}"></textarea>
            <input type="submit" value="ÎãµÎ≥Ä Îì±Î°ù">
        </form>
    </div>
<th:block layout:fragment="script"></th:block>
</body>
<script layout:fragment="script" th:src="@{/js/deleteConfirm.js}" type="text/javascript"></script>
<script layout:fragment="script" th:src="@{/js/recommendConfirm.js}" type="text/javascript"></script>
<script layout:fragment="script" th:src="@{/js/appearComment.js}" type="text/javascript"></script>
</html>